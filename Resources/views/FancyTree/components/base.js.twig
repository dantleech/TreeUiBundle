options = $.extend(options, {
    source: {
        url: "{{ path('_cmf_tree_ui_children', {'cmf_tree_ui_tree_name': tree.name}) }}?cmf_tree_ui_node_id={{ options['root_path'] }}"
    },
    init: function () {
        // The key path is generated in the controller and contains
        // all the descendant node IDs leading up to the selected node.
        {% if keyPath %}
            var tree = treeEl.fancytree('getTree');
            tree.loadKeyPath('{{ keyPath|raw }}', function (node, state) {
                if(state == "loaded") {
                } else if (state == "ok") {
                    node.setActive(true);
                    node.setSelected(true);
                }
            });

            return false;
        {% endif %}
    },
    lazyload: function (e, data) {
        var childrenUrl = data.node.data.children_url;
        data.result = $.ajax({
            url: childrenUrl,
            dataType: "json"
        });
    },
    keyPathSeparator: "&",
    debugLevel: 0
});
